{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2025-04-29 10:06:25.066897",
 "css": "\r\nbody {\r\n    font-family: Arial;\r\n    margin: 0 1px;\r\n    line-height: normal;\r\n}\r\n\r\n .container {\r\n        font-family: Arial, sans-serif;\r\n        font-size: 14px;\r\n        width: 100%;\r\n    }\r\n\r\n.content{\r\n    margin-top:15px;\r\n}\r\n    .flex-space-between {\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        height:250px;\r\n        background-color:#f4f4f4;\r\n        \r\n    }\r\n\r\n    .header {\r\n        margin-bottom: 5px;\r\n    }\r\n\r\n    .qr {\r\n        width: 250px;\r\n        height: 250px;\r\n    }\r\n\r\n  .logo {\r\n    /*transform: translateY(-10%);*/\r\n    /*background-color: red;*/\r\n    padding: 10px 5px 0 0;\r\n}\r\n    \r\n    .info-table{\r\n        width:100%;\r\n    }\r\n\r\n.header_m {\r\n    color: rgb(108, 107, 107);\r\n    font-weight: bold;\r\n    font-size: 40px;\r\n}\r\n\r\n.delivery-challan {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    /*background-color: red;*/\r\n    padding-bottom: 0 !important;\r\n}\r\n\r\n.space-from-border {\r\n    /*border-bottom: 1px solid black;*/\r\n    padding: 0px 6px 2px 10px ;\r\n}\r\n\r\n.sub-header {\r\n    font-weight: bold;\r\n    font-size: 28px;\r\n}\r\n\r\n.address {\r\n    transform: translateY(-10%); \r\n    color: rgb(74, 74, 74);\r\n}\r\n    \r\n.heading {\r\n    text-transform: uppercase;\r\n    color: black;\r\n    /*font-size: 12px;*/\r\n    font-weight: bold;\r\n}    \r\n\r\n.ship-details {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    gap: 10px; /* optional spacing between columns */\r\n    margin-bottom: 10px;\r\n    margin-top:20px;\r\n}\r\n\r\n.ship-details .column {\r\n    flex: 0 0 33.33%;\r\n    padding-right: 10px;\r\n    box-sizing: border-box;\r\n}\r\n\r\n\r\n.company_name {\r\n    font-size: 13px;   \r\n}\r\n\r\n.invoice_details{\r\n     font-size: 12px;\r\n}\r\n\r\n\r\n.table-container{\r\n    border-collapse: collapse;\r\n    width: 100%;\r\n}\r\n\r\n.table-container td {\r\n    border: 1px solid black !important;\r\n    padding: 3px !important;\r\n    margin: 0 !important;\r\n    font-size: 12px !important;\r\n    height:20px !important;\r\n    /*text-align: center;*/\r\n}\r\n\r\n.table-container th {\r\n    background-color: #f2f2f2 !important;\r\n    background-color: green;\r\n    border: 1px solid black !important;\r\n    padding: 3px !important;\r\n    margin: 0 !important;\r\n    color: black;\r\n    font-weight: bold;\r\n    text-align: center;\r\n    font-size: 13px !important;\r\n    height:20px !important;\r\n}\r\n\r\ntd.bordered-cell {\r\n    border: none !important;\r\n}\r\n\r\n.digital_sign {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: flex-end; /* This aligns children (image + text) to the right */\r\n    margin-top: 40px;\r\n    width: 250px;\r\n    margin-left: auto; /* Pushes the whole block to the right */\r\n}\r\n\r\n\r\n.approver_de {\r\n    color: black;\r\n    /*font-size: 12px;*/\r\n    font-weight: bold;\r\n    text-align:center;\r\n    margin-right:50px;\r\n    margin-top:20px;\r\n}\r\n\r\n.footer {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: flex-end;\r\n    align-items: flex-start;   /* align content to the left */\r\n    margin-top: auto;          /* ensure it pushes from the top if inside a flex parent */\r\n}\r\n\r\n",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Sales Invoice",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "{%- set sales_order = frappe.get_doc(\"Sales Order\", doc.items[0].sales_order) %}\r\n\r\n<!--To get Location based address -->\r\n{% set location = sales_order.custom_location or '' %}\r\n\r\n{% if location == \"Chennai\" %}\r\n  {% set address = frappe.get_doc(\"Address\", \"Protocol Labels India Pvt Ltd.,\") %}\r\n{% elif location %}\r\n  {% set address = frappe.get_doc(\"Address\", \"Protocol Labels India Private Limited-Billing\") %}\r\n{% else %}\r\n  {% set address = None %}\r\n{% endif %}\r\n\r\n<!--To check currency type:-->\r\n{% set currency_namespace = namespace(currency_type='') %}\r\n\r\n{% if doc.currency == 'INR' %}\r\n    {% set currency_namespace.currency_type = '\u20b9' %}\r\n{% elif doc.currency == 'USD' %}\r\n    {% set currency_namespace.currency_type = '$' %}\r\n{% else %}\r\n    {% set currency_namespace.currency_type = doc.currency + ': ' %}\r\n{% endif %}\r\n\r\n<!--To fetch the serial numbers against each item:-->\r\n{% macro get_serial_numbers(item_code, rate, delivery_note) %}\r\n  {% set doc = frappe.get_doc('Delivery Note', delivery_note) %}\r\n  {% set serial_numbers = [] %}\r\n\r\n  {# Collect serial numbers for the specific item_code and rate #}\r\n  {% for item in doc.items %}\r\n    {% if item.item_code == item_code and item.rate == rate and item.serial_and_batch_bundle %}\r\n      {% set serial_bundle = frappe.get_doc('Serial and Batch Bundle', item.serial_and_batch_bundle) %}\r\n      \r\n      {% for entry in serial_bundle.entries %}\r\n        {% set _ = serial_numbers.append(entry.serial_no) %}\r\n      {% endfor %}\r\n    {% endif %}\r\n  {% endfor %}\r\n\r\n  {# Return serial numbers as a comma-separated string #}\r\n  {{ serial_numbers | join(', ') }}\r\n{% endmacro %}\r\n\r\n<div class=\"container\">\r\n\r\n    <!--E-invoice Header Section -->\r\n    {% if doc.irn %}\r\n    {% set e_invoice_log = frappe.db.get_value(\"e-Invoice Log\", doc.irn, (\"invoice_data\"), as_dict=True) %}\r\n    {%- set invoice_data = _dict(json.loads(e_invoice_log.invoice_data)) -%}\r\n    <div class=\"flex-space-between header\">\r\n        <div style=\"padding:20px;font-size: 20px\">\r\n            <p></p><strong>Government Of India</strong></p>\r\n            <strong>e-Invoice System</strong>\r\n        </div>\r\n        <div>\r\n            {% set e_invoice_log = frappe.db.get_value(\"e-Invoice Log\", doc.irn, (\"signed_qr_code\"), as_dict=True) %}\r\n            <img src=data:image/png;base64,{{ get_qr_code(e_invoice_log.signed_qr_code, scale=2)  }} class=\"qr\">\r\n        </div>\r\n    </div>\r\n   \r\n\r\n    <!-- e-Invoice Details -->\r\n    <table class=\"info-table\" style=\"width: 100%; border-collapse: collapse;margin-top:10px\">\r\n        <thead>\r\n            <tr>\r\n                <th colspan=\"3\" style=\"text-align: left; padding: 6px;\">\r\n                    <span class=\"header\">e-Invoice Details</span>\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr>\r\n                <td style=\"width: 40%; word-wrap: break-word; word-break: break-all; padding: 6px;\">\r\n                    <span><strong>IRN</strong></span>\r\n                    <span class=\"invoice_details\">{{ invoice_data.Irn }}</span>\r\n                </td>\r\n                <td style=\"width: 30%; word-wrap: break-word; word-break: break-word; padding: 6px;\">\r\n                    <span><strong>Ack. No</strong></span>\r\n                    <span class=\"invoice_details\">{{ invoice_data.AckNo }}</span>\r\n                </td>\r\n                <td style=\"width: 30%; word-wrap: break-word; word-break: break-word; padding: 6px;\">\r\n                    <span><strong>Ack. Date</strong></span>\r\n                    <span class=\"invoice_details\">{{ frappe.utils.format_datetime(invoice_data.AckDt, \"dd-MM-yyyy hh:mm:ss\") }}</span>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n\r\n    {%endif%}\r\n    <div class=\"content\">\r\n        <div class=\"delivery-challan space-from-border\">\r\n            <div>\r\n                <p class=\"header_m\" style=\"margin-top:10px\">Credit Note</p>\r\n                \r\n                <h3 class=\"sub-header\">{{doc.company_address.replace('-Billing', '')}}</h3>\r\n            </div>\r\n            <div class=\"logo\">\r\n                <img src=\"/files/erpnext-logo.png\" alt=\"logo\" height=\"100px\" width=\"100px\">\r\n            </div>\r\n        </div>\r\n        <div class=\"address space-from-border\">\r\n            <!--<p class=\"company-address\">{{doc.company_address_display}}</p>-->\r\n            {% if location == \"\" %}\r\n            \t <p class=\"company-address\">\r\n                    {{doc.company_address_display}}\r\n                </p>\r\n            {% else %}\r\n                <p class=\"company-address\">\r\n                  {{ address.address_line1 }}<br>\r\n                  {{ address.address_line2 }}<br>\r\n                  {{ address.city }}</p>\r\n                  {{ address.state }}, State Code: {{ address.gst_state_number }}<br>\r\n                  PIN Code: {{ address.pincode }}<br>\r\n                  {{ address.country }}<br>\r\n                  GSTIN: {{ address.gstin }}<br>\r\n                </p>\r\n            {% endif %}\r\n        </div>\r\n        \r\n        <div class=\"ship-details space-from-border\">\r\n            <div class=\"column\">\r\n                <p class=\"heading\">Bill To</p>\r\n                <p class=\"company_name\">\r\n                    {{ doc.customer_address.replace('-Billing', '') if doc.customer_address else '' }}\r\n                </p>\r\n                <p>\r\n                    {{ doc.address_display if doc.address_display else '' }}\r\n                </p>\r\n            </div>\r\n        \r\n            <div class=\"column\">\r\n                <p class=\"heading\">Ship To</p>\r\n                <p class=\"company_name\">\r\n                    {{ doc.shipping_address_name.replace('-Billing', '') if doc.shipping_address_name else '' }}\r\n                </p>\r\n                <p>\r\n                    {{ doc.company_address_display if doc.shipping_address else '' }}\r\n                </p>\r\n            </div>\r\n        \r\n            <div class=\"column\">\r\n                <p><span class=\"heading\">CN Number :</span> {{ doc.name }}</p>\r\n                <p><span class=\"heading\">CN Date :</span> {{ frappe.utils.format_date(doc.posting_date, \"dd-mm-yyyy\") }}</p>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    \r\n    <div class=\"cost-details\">\r\n                <table class=\"table-container\">\r\n                    <thead>\r\n                        <tr>\r\n                            <th style=\"border-left: 0px solid black;\">Sl.No</th>\r\n                            <th>Item Name</th>\r\n                            <th>Serial No</th>\r\n                            <th>Qty</th>\r\n                            <th>Amount</th>\r\n                            <th>Tax</th>\r\n                            <th>Tax Amount</th>\r\n                            <th>Line Amount</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {% for item in doc.items %} \r\n                        <tr>\r\n                            <td style=\"border-left: 0px solid black;\" class=\"center-div\">\r\n                                {{ loop.index }}\r\n                            </td>\r\n                            <td>{{ item.item_name }}</td>\r\n                            <td class=\"left-align serial-no\">\r\n                             {% if item.delivery_note %}\r\n                                {{ get_serial_numbers(item.item_code, item.rate, item.delivery_note) }}\r\n                              {% endif %}\r\n                            </td> \r\n                            <td>{{ item.qty | int }}</td>\r\n                            <td>{{ \"{:,.2f}\".format(item.rate) }}</td>\r\n                            <td>\r\n                                GST {{ (item.cgst_rate + item.sgst_rate + item.igst_rate) | int }}%\r\n                            </td>\r\n                            <td>\r\n                                {% set tax_amount = item.cgst_amount + item.sgst_amount + item.igst_amount %}\r\n                                {{\"{:,.2f}\".format(tax_amount)}}\r\n                            </td>\r\n                            <td>\r\n                                {{ \"{:,.2f}\".format(tax_amount + (item.rate*item.qty)) }}\r\n                            </td>\r\n                        </tr>\r\n                        {% endfor %}\r\n                \r\n                        <!-- Summary rows (moved from tfoot) -->\r\n                        <tfoot>\r\n                        <tr>\r\n                             <td colspan=\"6\" class=\"bordered-cell\"></td>\r\n                            <td style=\"text-align: right;\"><strong>Subtotal</strong></td>\r\n                            <td>{{ currency_namespace.currency_type }} {{ \"{:,.2f}\".format(doc.total) }}</td>\r\n                        </tr>\r\n                        <tr>\r\n                             <td colspan=\"6\" class=\"bordered-cell\"></td>\r\n                            <td style=\"text-align: right;\"><strong>Taxable Value </strong></td>\r\n                            <td>{{ currency_namespace.currency_type }} {{ \"{:,.2f}\".format(doc.base_total_taxes_and_charges) }}</td>\r\n                        </tr>\r\n                        <tr>\r\n                             <td colspan=\"6\" class=\"bordered-cell\"></td>\r\n                            <td style=\"text-align: right;\"><strong>Total</strong></td>\r\n                            <td>{{ currency_namespace.currency_type }} {{ \"{:,.2f}\".format(doc.grand_total) }}</td>\r\n                        </tr>\r\n                        </tfoot>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n    <div class=\"digital_sign\">\r\n        <div>\r\n            <img src=\"/files/ch-d.png\" height=\"50px\" width=\"90%\" alt=\"Digital Sign\">\r\n        </div>\r\n        <div class=\"approver_de\">Approved By</div>\r\n    </div>\r\n    \r\n    \r\n    \r\n    \r\n        {% set delivery_note = doc.items[0].delivery_note %}\r\n        {% set dn = frappe.get_doc(\"Delivery Note\", delivery_note) %}\r\n        {% set sales_invoices = frappe.get_all(\"Sales Invoice\", fields=[\"name\",\"posting_date\"], filters=[[\"Sales Invoice Item\", \"delivery_note\", \"=\", dn.return_against]]) %}\r\n        {%- set original_data = namespace(name=\"\", date=\"\") -%}\r\n        \r\n    {%- if sales_invoices and sales_invoices[0] -%}\r\n            {%- set original_data.name = sales_invoices[0].name -%}\r\n            {%- set original_data.date = sales_invoices[0].posting_date -%}\r\n             <div class=\"footer\">\r\n                <div>Notes</div>\r\n        \r\n                <div><span>Original Invoice NO: {{ original_data.name }} </span></div>\r\n                <div><span>Original Invoice Date: {{ frappe.utils.format_date(original_data.date, \"dd-mm-yyyy\") }} </span></div>\r\n                \r\n            </div>\r\n    {%- endif -%}\r\n   \r\n</div>\r\n   \r\n    \r\n    \r\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2025-06-30 13:25:11.001178",
 "modified_by": "Administrator",
 "module": "Custom App",
 "name": "Credit Note SI",
 "owner": "Administrator",
 "page_number": "Hide",
 "pdf_generator": "wkhtmltopdf",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}